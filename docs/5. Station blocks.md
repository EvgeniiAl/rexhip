### Station blocks (SB)

The library introduce a concept called station blocks (SB). A SB corespond to GSD-file for profibus, it's a device profiles for one specific modbus device, containing all the queries needed to communicate with that specific modbus device. Setup modbus communication with a VFD (Variable-frequency drive) for example, can take a work day or two. The idea behind the library is that, this can be done once and the SB’s can be shared and reused in new applications. The library includes many predefined SB’s, that is freely available. New contributions to the repository are welcome. 

A SB can plug into both modbus tcp and modbus rtu application, this is quite convenient if a tcp-rtu-gateway is used. Different SB's can easily be combined in the same application, and there can be muliple instances of each SB. 

```pascal
// Every SB should start with a station header. It gives a lot extra
// functionality. #sb bellow, is a special udt that comes along with the 
// library. (mb_station_block_udt)
"mb_station_block_header"(sb := #sb, mb_query := #mb_query);

// #mb_query should be io/out-parameter on the block.

// Device address is the same for all queries, and therefore only need to 
// be defined once. #mb_addr is typically a input parameter on the block.
#mb_query.mb_addr := #mb_addr;

// Queries for each function codes are usally grouped together and the 
// function code is defined once above the queries.
#mb_query.mode := #mb_query.c.read.holding_reg,
#mb_query(data_addr := 123, data_ptr := #resault_data_query_1);
#mb_query(data_addr := 456, data_ptr := #resault_data_query_2);
#mb_query(data_addr := 789, data_ptr := #resault_data_query_3);

// Another group of queries with a different function code.
#mb_query.mode := #mb_query.c.read.input_reg,
#mb_query(data_addr := 123, data_ptr := #resault_data_query_4);
#mb_query(data_addr := 456, data_ptr := #resault_data_query_5);

// Each variable connected to data_ptr, is usally a struct, 
// coresponding to data inside the device.

// In the buttom of each SB, after all the quries, the footer should
// be executed. 
"mb_station_block_footer"(sb := #sb, mb_query := #mb_query);

// IMPORTANT: No code that interupt the execution (like return)
// should be placed between the header and the foother.

// For this example values are set to zero if communication problems accrue.
IF #s.out.error_comm THEN
    #resault_data_query_1 := 0;   
END_IF;
```

#### features of mb_station_header and mb_station_footer
- conf.
- .disable: If eneabled all queries will be skipped and query execution is send to the next SB.
- .read_only: Only read queries will be executed. If a write query is inserted, it will be reject at the footer, and query execution is sent to the next SB. The internal SB counter will be increaded by one.
- .max_comm_error: Max number of repeating communication error before the communcation error flag is set. If the flag is set then all the queries inside the SB are skipped, and retries is only retrid Occasionally.
- .exec_x_queries: Number of queries inside the station blocks that should be executed at each loop.

- out.
- .error: Set true for all errors including including .error_comm
- .error_comm: set true after repeating queries resualting in communcation problems. (timeouts or bad crc)
- .finnish: Set true when the query execution is handed over to the next SB.

- log.
- .connected_time: The time the device was connected. 1st.jan.1970 if it's always been connected.
- .disconnected_time: Last time the device was disconnected.
- .done_cnt: Count nunmber of successfully queries.
- .error_comm_cnt: Only communication errors, timeouts or bad crc.
- .error_exception: All other errors except communication errors.
- .error_status: status code the error query/queries.
- .error_data_addr: data_addr of the query that has led to error.

- z. Variables for internal use.

The header and the foother will also prevent the impact of setting if-statements around queries. The "hiccup" effect.

#### Save memory

The header and foother in a station blocks gives many nice features, though they are not required for the quries to execute. 
If memory is limited they can be removed. Also then remove #sb-udt in the satic variable section. 
